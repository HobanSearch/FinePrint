# Fine Print AI - Configuration Management System\n\nA production-ready configuration management system with hot-reload capabilities, feature flags, encrypted secrets, and real-time updates via WebSocket.\n\n## Features\n\n### üîß Dynamic Configuration Management\n- **Environment-aware configuration loading**\n- **Hot-reload without service restarts**\n- **Configuration validation with Zod schemas**\n- **Version control and rollback capabilities**\n- **Audit logging for all changes**\n\n### üö© Advanced Feature Flags\n- **Gradual rollout with percentage-based deployment**\n- **A/B testing with multiple variants**\n- **User/agent-specific feature toggles**\n- **Date-based rollout scheduling**\n- **Dependency management between flags**\n- **Real-time flag evaluation analytics**\n\n### üîí Encrypted Secret Management\n- **AES-256-GCM encryption for sensitive values**\n- **Key rotation support**\n- **Expiration management**\n- **Access tracking and audit logs**\n- **Automatic cleanup of expired secrets**\n\n### ‚ö° High Performance\n- **Redis caching with configurable TTL**\n- **Connection pooling and retry logic**\n- **Distributed caching across instances**\n- **Performance metrics and monitoring**\n\n### üîÑ Real-time Updates\n- **WebSocket support for live configuration updates**\n- **Service registration and discovery**\n- **Cross-instance synchronization via Redis pub/sub**\n- **Connection management and health monitoring**\n\n### üìä Monitoring & Observability\n- **Comprehensive health checks**\n- **Prometheus-compatible metrics**\n- **Structured logging with different levels**\n- **Performance tracking and alerting**\n\n## Quick Start\n\n### Installation\n\n```bash\nnpm install @fineprintai/shared-config\n```\n\n### Basic Usage\n\n```typescript\nimport { createConfigurationSystem } from '@fineprintai/shared-config';\n\n// Create configuration system instance\nconst configSystem = createConfigurationSystem({\n  databaseUrl: process.env.DATABASE_URL,\n  redisUrl: process.env.REDIS_URL,\n  encryptionKey: process.env.CONFIG_ENCRYPTION_KEY,\n  apiPort: 3001,\n  wsPort: 8080,\n});\n\n// Initialize and start the system\nasync function main() {\n  await configSystem.initialize();\n  const address = await configSystem.start();\n  console.log(`Configuration API running at ${address}`);\n}\n\nmain().catch(console.error);\n```\n\n### Environment Variables\n\n```bash\n# Required\nDATABASE_URL=postgresql://user:password@localhost:5432/fineprintai\nREDIS_URL=redis://localhost:6379\nCONFIG_ENCRYPTION_KEY=your-32-character-encryption-key\n\n# Optional\nCONFIG_API_PORT=3001\nCONFIG_WS_PORT=8080\nLOG_LEVEL=info\nNODE_ENV=development\n```\n\n## API Reference\n\n### Configuration Management\n\n#### Get Configuration\n```http\nGET /api/config/:serviceName?environment=production&version=1&includeSecrets=false\n```\n\n#### Update Configuration\n```http\nPUT /api/config/:serviceName\nContent-Type: application/json\n\n{\n  \"environment\": \"production\",\n  \"config\": {\n    \"feature\": {\n      \"enabled\": true,\n      \"timeout\": 5000\n    }\n  },\n  \"description\": \"Enable new feature\",\n  \"tags\": [\"feature\", \"v2\"],\n  \"secrets\": {\n    \"apiKey\": \"secret-value\"\n  }\n}\n```\n\n#### Trigger Hot Reload\n```http\nPOST /api/config/:serviceName/reload\nContent-Type: application/json\n\n{\n  \"environment\": \"production\",\n  \"force\": false\n}\n```\n\n#### Get Configuration History\n```http\nGET /api/config/:serviceName/history?environment=production&limit=10&offset=0\n```\n\n### Feature Flags\n\n#### Get All Feature Flags\n```http\nGET /api/features?environment=production&enabled=true&tags=experiment\n```\n\n#### Create Feature Flag\n```http\nPOST /api/features\nContent-Type: application/json\n\n{\n  \"name\": \"New Checkout Flow\",\n  \"description\": \"A/B test for new checkout process\",\n  \"enabled\": true,\n  \"rollout\": {\n    \"percentage\": 25,\n    \"userGroups\": [\"beta-users\"],\n    \"regions\": [\"us-east\"],\n    \"startDate\": \"2024-01-01T00:00:00Z\",\n    \"endDate\": \"2024-03-01T00:00:00Z\"\n  },\n  \"variants\": [\n    {\n      \"id\": \"control\",\n      \"name\": \"Current Flow\",\n      \"weight\": 50,\n      \"configuration\": {}\n    },\n    {\n      \"id\": \"treatment\",\n      \"name\": \"New Flow\",\n      \"weight\": 50,\n      \"configuration\": {\n        \"newCheckout\": true,\n        \"theme\": \"modern\"\n      }\n    }\n  ],\n  \"dependencies\": [],\n  \"tags\": [\"checkout\", \"experiment\"]\n}\n```\n\n#### Evaluate Feature Flags\n```http\nPOST /api/features/evaluate\nContent-Type: application/json\n\n{\n  \"flags\": [\"new_checkout_flow\", \"premium_features\"],\n  \"context\": {\n    \"userId\": \"user-123\",\n    \"userGroup\": \"beta-users\",\n    \"region\": \"us-east\",\n    \"environment\": \"production\",\n    \"customAttributes\": {\n      \"subscriptionTier\": \"premium\"\n    }\n  }\n}\n```\n\n#### Get Flag Analytics\n```http\nGET /api/features/new_checkout_flow/analytics?startDate=2024-01-01&endDate=2024-01-31\n```\n\n### Service Registration\n\n#### Register Service\n```http\nPOST /api/services/register\nContent-Type: application/json\n\n{\n  \"serviceName\": \"user-service\",\n  \"displayName\": \"User Management Service\",\n  \"description\": \"Handles user authentication and profiles\",\n  \"version\": \"2.1.0\",\n  \"endpoints\": [\"http://user-service:3000\"],\n  \"healthCheck\": \"http://user-service:3000/health\",\n  \"requiredConfigs\": [\"DATABASE_URL\", \"JWT_SECRET\"],\n  \"optionalConfigs\": [\"REDIS_URL\", \"SENTRY_DSN\"],\n  \"environment\": \"production\",\n  \"tags\": [\"core\", \"auth\"]\n}\n```\n\n## WebSocket Integration\n\nConnect to the WebSocket server for real-time configuration updates:\n\n```typescript\nimport WebSocket from 'ws';\n\nconst ws = new WebSocket('ws://localhost:8080');\n\nws.on('open', () => {\n  // Subscribe to configuration changes\n  ws.send(JSON.stringify({\n    type: 'SUBSCRIBE',\n    serviceName: 'user-service',\n    environment: 'production',\n    subscriptions: ['config-updates', 'feature-flags']\n  }));\n});\n\nws.on('message', (data) => {\n  const message = JSON.parse(data.toString());\n  \n  switch (message.type) {\n    case 'CONFIGURATION_UPDATE':\n      console.log('Configuration updated:', message.config);\n      // Reload your service configuration\n      break;\n      \n    case 'FEATURE_FLAG_UPDATE':\n      console.log('Feature flag updated:', message.flagKey, message.enabled);\n      // Update feature flag cache\n      break;\n      \n    case 'CONFIGURATION_RELOAD':\n      console.log('Configuration reload requested');\n      // Perform full configuration reload\n      break;\n  }\n});\n```\n\n## Client Libraries\n\n### JavaScript/TypeScript Client\n\n```typescript\nimport { ConfigurationClient } from '@fineprintai/config-client';\n\nconst client = new ConfigurationClient({\n  apiUrl: 'http://localhost:3001',\n  wsUrl: 'ws://localhost:8080',\n  serviceName: 'user-service',\n  environment: 'production',\n});\n\n// Get configuration\nconst config = await client.getConfiguration();\n\n// Evaluate feature flags\nconst flags = await client.evaluateFlags({\n  userId: 'user-123',\n  userGroup: 'premium',\n});\n\n// Subscribe to real-time updates\nclient.on('configurationUpdate', (newConfig) => {\n  // Handle configuration change\n});\n\nclient.on('featureFlagUpdate', (flagKey, enabled) => {\n  // Handle feature flag change\n});\n```\n\n## Development\n\n### Setup Development Environment\n\n```bash\n# Clone the repository\ngit clone <repository-url>\ncd backend/shared/config\n\n# Install dependencies\nnpm install\n\n# Set up environment variables\ncp .env.example .env\n\n# Generate Prisma client\nnpm run db:generate\n\n# Run database migrations\nnpm run db:migrate\n\n# Start development server\nnpm run dev\n```\n\n### Running Tests\n\n```bash\n# Run all tests\nnpm test\n\n# Run tests in watch mode\nnpm run test:watch\n\n# Run tests with coverage\nnpm test -- --coverage\n```\n\n### Database Operations\n\n```bash\n# Generate Prisma client\nnpm run db:generate\n\n# Push schema changes to database\nnpm run db:push\n\n# Create and run migrations\nnpm run db:migrate\n\n# Reset database (development only)\nnpx prisma migrate reset\n```\n\n## Architecture\n\n### System Components\n\n1. **Configuration Service** - Core configuration management\n2. **Feature Flags Service** - Feature flag evaluation and management\n3. **Secret Management Service** - Encrypted secret storage\n4. **WebSocket Service** - Real-time updates\n5. **Cache Service** - Redis-based caching layer\n6. **Monitoring Service** - Metrics and health checks\n\n### Data Flow\n\n```\n[Client] ‚Üí [API Gateway] ‚Üí [Configuration Service] ‚Üí [Database]\n    ‚Üì                              ‚Üì                      ‚Üì\n[WebSocket] ‚Üê [Event Bus] ‚Üê [Cache Layer] ‚Üê [Redis]\n```\n\n### Security Model\n\n- **Encryption**: AES-256-GCM for secrets with key rotation\n- **Authentication**: JWT-based with role-based access control\n- **Authorization**: Service-level permissions\n- **Audit Logging**: All configuration changes tracked\n- **Rate Limiting**: Per-service and global limits\n\n## Performance Characteristics\n\n- **Configuration Retrieval**: <10ms (cached), <50ms (database)\n- **Feature Flag Evaluation**: <5ms average\n- **WebSocket Message Delivery**: <100ms\n- **Cache Hit Rate**: >95% typical\n- **Throughput**: 10,000+ requests/second per instance\n\n## Monitoring and Alerts\n\n### Health Checks\n\n```http\nGET /health\n```\n\nReturns detailed health status for all components.\n\n### Metrics\n\n```http\nGET /metrics\n```\n\nPrometheus-compatible metrics including:\n- Configuration access patterns\n- Feature flag evaluation rates\n- Cache hit/miss ratios\n- WebSocket connection counts\n- Database query performance\n\n### Logging\n\nStructured JSON logging with configurable levels:\n- **Error**: System errors and failures\n- **Warn**: Performance issues and deprecations\n- **Info**: Configuration changes and events\n- **Debug**: Detailed execution traces\n\n## Deployment\n\n### Docker\n\n```dockerfile\nFROM node:20-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production\nCOPY dist ./dist\nEXPOSE 3001 8080\nCMD [\"node\", \"dist/index.js\"]\n```\n\n### Kubernetes\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: config-service\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: config-service\n  template:\n    metadata:\n      labels:\n        app: config-service\n    spec:\n      containers:\n      - name: config-service\n        image: fineprintai/config-service:latest\n        ports:\n        - containerPort: 3001\n        - containerPort: 8080\n        env:\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: config-secrets\n              key: database-url\n        - name: REDIS_URL\n          valueFrom:\n            secretKeyRef:\n              name: config-secrets\n              key: redis-url\n        - name: CONFIG_ENCRYPTION_KEY\n          valueFrom:\n            secretKeyRef:\n              name: config-secrets\n              key: encryption-key\n        livenessProbe:\n          httpGet:\n            path: /health\n            port: 3001\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /health\n            port: 3001\n          initialDelaySeconds: 5\n          periodSeconds: 5\n```\n\n## Contributing\n\n1. Fork the repository\n2. Create a feature branch\n3. Make your changes\n4. Add tests\n5. Run the test suite\n6. Submit a pull request\n\n## License\n\nPrivate - Fine Print AI Internal Use Only\n\n## Support\n\nFor issues and questions:\n- Create an issue in the repository\n- Contact the infrastructure team\n- Check the documentation wiki\n\n---\n\n**Fine Print AI Configuration Management System v2.0.0**\n\nBuilt with ‚ù§Ô∏è for autonomous AI business operations."