<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fine Print AI - Test Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .stat-card.success { border-left-color: #10b981; }
        .stat-card.warning { border-left-color: #f59e0b; }
        .stat-card.error { border-left-color: #ef4444; }
        .stat-card.info { border-left-color: #3b82f6; }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #64748b;
        }

        .stat-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive { color: #10b981; }
        .stat-change.negative { color: #ef4444; }
        .stat-change.neutral { color: #64748b; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .test-suites {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .suite-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .suite-header {
            padding: 1rem 1.5rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .suite-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .suite-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .suite-status.passed { background: #dcfce7; color: #166534; }
        .suite-status.failed { background: #fecaca; color: #991b1b; }
        .suite-status.partial { background: #fed7aa; color: #9a3412; }

        .suite-body {
            padding: 1.5rem;
        }

        .metrics-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .metrics-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #64748b;
        }

        .metric-value {
            font-weight: 600;
            color: #1e293b;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f1f5f9;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }

        .alerts {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .alerts-header {
            padding: 1rem 1.5rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .alert-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            flex-shrink: 0;
        }

        .alert-icon.critical { background: #ef4444; }
        .alert-icon.warning { background: #f59e0b; }
        .alert-icon.info { background: #3b82f6; }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .alert-description {
            font-size: 0.875rem;
            color: #64748b;
        }

        .footer {
            text-align: center;
            color: #64748b;
            font-size: 0.875rem;
            padding: 2rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 3rem;
        }

        .refresh-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .refresh-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .refresh-button:hover {
            background: #2563eb;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .test-suites {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Fine Print AI Test Dashboard</h1>
        <p>Comprehensive Testing & Quality Metrics</p>
    </div>

    <div class="container">
        <div class="refresh-info">
            <div>
                <strong>Last Updated:</strong> <span id="lastUpdated">Loading...</span> |
                <strong>Build:</strong> <span id="buildNumber">-</span> |
                <strong>Branch:</strong> <span id="branchName">-</span>
            </div>
            <button class="refresh-button" onclick="loadData()">Refresh Data</button>
        </div>

        <!-- Key Metrics Cards -->
        <div class="stats-grid" id="statsGrid">
            <!-- Generated dynamically -->
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">Code Coverage Trends</h3>
                <div class="chart-container">
                    <canvas id="coverageChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">Test Results Distribution</h3>
                <div class="chart-container">
                    <canvas id="testResultsChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">Performance Metrics</h3>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">Security Vulnerabilities</h3>
                <div class="chart-container">
                    <canvas id="securityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Test Suites -->
        <div class="test-suites" id="testSuites">
            <!-- Generated dynamically -->
        </div>

        <!-- Alerts -->
        <div class="alerts">
            <div class="alerts-header">üö® Alerts & Recommendations</div>
            <div id="alertsList">
                <!-- Generated dynamically -->
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Generated by Fine Print AI Testing Framework | Last refresh: <span id="footerTimestamp">-</span></p>
    </div>

    <script>
        let metricsData = null;
        let charts = {};

        async function loadData() {
            try {
                // In a real implementation, this would fetch from an API
                // For now, we'll load from a JSON file
                const response = await fetch('./latest-metrics.json');
                metricsData = await response.json();
                
                updateDashboard();
            } catch (error) {
                console.error('Failed to load metrics data:', error);
                // Load mock data for demonstration
                loadMockData();
            }
        }

        function loadMockData() {
            metricsData = {
                timestamp: new Date().toISOString(),
                build: '123',
                branch: 'main',
                commit: 'abc123',
                platform: 'ubuntu-latest',
                coverage: {
                    overall: { lines: 92.5, functions: 89.3, branches: 88.7, statements: 91.2 },
                    frontend: { lines: 94.2, functions: 91.5, branches: 90.1, statements: 93.8, covered: 1542, total: 1635 },
                    backend: { lines: 90.8, functions: 87.1, branches: 87.3, statements: 88.6, covered: 2341, total: 2578 },
                    mobile: { lines: 88.3, functions: 85.2, branches: 82.9, statements: 87.1, covered: 892, total: 1010 },
                    extension: { lines: 86.7, functions: 84.3, branches: 81.5, statements: 85.9, covered: 445, total: 513 }
                },
                tests: {
                    total: 1247,
                    passed: 1198,
                    failed: 3,
                    skipped: 46,
                    duration: 145000,
                    suites: {
                        unit: { total: 523, passed: 518, failed: 2, skipped: 3, duration: 32000, flaky: 1 },
                        integration: { total: 187, passed: 185, failed: 1, skipped: 1, duration: 45000, flaky: 0 },
                        e2e: { total: 234, passed: 229, failed: 0, skipped: 5, duration: 89000, flaky: 2 },
                        mobile: { total: 156, passed: 152, failed: 0, skipped: 4, duration: 67000, flaky: 1 },
                        extension: { total: 89, passed: 87, failed: 0, skipped: 2, duration: 23000, flaky: 0 },
                        ai: { total: 58, passed: 57, failed: 0, skipped: 1, duration: 34000, flaky: 0 }
                    }
                },
                performance: {
                    loadTest: {
                        avgResponseTime: 245,
                        p95ResponseTime: 489,
                        p99ResponseTime: 756,
                        errorRate: 0.02,
                        throughput: 125.3
                    },
                    lighthouse: {
                        performance: 94,
                        accessibility: 98,
                        bestPractices: 92,
                        seo: 89
                    }
                },
                security: {
                    vulnerabilities: { critical: 0, high: 1, medium: 3, low: 7 },
                    tests: {
                        sqlInjection: true,
                        xss: true,
                        csrf: true,
                        authentication: true,
                        headers: false
                    }
                },
                accessibility: {
                    wcagLevel: 'AA',
                    violations: { critical: 0, serious: 2, moderate: 5, minor: 12 },
                    score: 87.3
                }
            };
            
            updateDashboard();
        }

        function updateDashboard() {
            updateHeader();
            updateStatsCards();
            updateCharts();
            updateTestSuites();
            updateAlerts();
        }

        function updateHeader() {
            document.getElementById('lastUpdated').textContent = new Date(metricsData.timestamp).toLocaleString();
            document.getElementById('buildNumber').textContent = metricsData.build;
            document.getElementById('branchName').textContent = metricsData.branch;
            document.getElementById('footerTimestamp').textContent = new Date().toLocaleString();
        }

        function updateStatsCards() {
            const statsGrid = document.getElementById('statsGrid');
            
            const stats = [
                {
                    title: 'Overall Coverage',
                    value: `${metricsData.coverage.overall.lines.toFixed(1)}%`,
                    change: '+2.3%',
                    trend: 'positive',
                    type: metricsData.coverage.overall.lines >= 90 ? 'success' : 'warning',
                    icon: 'üìä'
                },
                {
                    title: 'Test Success Rate',
                    value: `${((metricsData.tests.passed / metricsData.tests.total) * 100).toFixed(1)}%`,
                    change: `${metricsData.tests.failed} failed`,
                    trend: metricsData.tests.failed === 0 ? 'positive' : 'negative',
                    type: metricsData.tests.failed === 0 ? 'success' : 'error',
                    icon: '‚úÖ'
                },
                {
                    title: 'Performance Score',
                    value: `${metricsData.performance.lighthouse.performance}`,
                    change: `${metricsData.performance.loadTest.avgResponseTime}ms avg`,
                    trend: 'neutral',
                    type: metricsData.performance.lighthouse.performance >= 90 ? 'success' : 'warning',
                    icon: '‚ö°'
                },
                {
                    title: 'Security Status',
                    value: `${metricsData.security.vulnerabilities.critical + metricsData.security.vulnerabilities.high}`,
                    change: 'Critical/High',
                    trend: metricsData.security.vulnerabilities.critical === 0 ? 'positive' : 'negative',
                    type: metricsData.security.vulnerabilities.critical === 0 ? 'success' : 'error',
                    icon: 'üîí'
                },
                {
                    title: 'Accessibility',
                    value: `${metricsData.accessibility.score.toFixed(1)}%`,
                    change: `${metricsData.accessibility.violations.critical + metricsData.accessibility.violations.serious} issues`,
                    trend: metricsData.accessibility.violations.critical === 0 ? 'positive' : 'negative',
                    type: metricsData.accessibility.score >= 85 ? 'success' : 'warning',
                    icon: '‚ôø'
                },
                {
                    title: 'Build Time',
                    value: `${Math.round(metricsData.tests.duration / 1000 / 60)}m`,
                    change: `${metricsData.tests.total} tests`,
                    trend: 'neutral',
                    type: 'info',
                    icon: '‚è±Ô∏è'
                }
            ];

            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card ${stat.type}">
                    <div class="stat-header">
                        <div class="stat-title">${stat.title}</div>
                        <div class="stat-icon" style="background: ${getTypeColor(stat.type)}">${stat.icon}</div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-change ${stat.trend}">${stat.change}</div>
                </div>
            `).join('');
        }

        function getTypeColor(type) {
            const colors = {
                success: '#10b981',
                warning: '#f59e0b',
                error: '#ef4444',
                info: '#3b82f6'
            };
            return colors[type] || '#64748b';
        }

        function updateCharts() {
            // Coverage Chart
            if (charts.coverage) charts.coverage.destroy();
            charts.coverage = new Chart(document.getElementById('coverageChart'), {
                type: 'line',
                data: {
                    labels: ['Frontend', 'Backend', 'Mobile', 'Extension', 'Overall'],
                    datasets: [{
                        label: 'Lines Coverage',
                        data: [
                            metricsData.coverage.frontend.lines,
                            metricsData.coverage.backend.lines,
                            metricsData.coverage.mobile.lines,
                            metricsData.coverage.extension.lines,
                            metricsData.coverage.overall.lines
                        ],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Test Results Chart
            if (charts.testResults) charts.testResults.destroy();
            charts.testResults = new Chart(document.getElementById('testResultsChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Passed', 'Failed', 'Skipped'],
                    datasets: [{
                        data: [metricsData.tests.passed, metricsData.tests.failed, metricsData.tests.skipped],
                        backgroundColor: ['#10b981', '#ef4444', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Performance Chart
            if (charts.performance) charts.performance.destroy();
            charts.performance = new Chart(document.getElementById('performanceChart'), {
                type: 'radar',
                data: {
                    labels: ['Performance', 'Accessibility', 'Best Practices', 'SEO'],
                    datasets: [{
                        label: 'Lighthouse Scores',
                        data: [
                            metricsData.performance.lighthouse.performance,
                            metricsData.performance.lighthouse.accessibility,
                            metricsData.performance.lighthouse.bestPractices,
                            metricsData.performance.lighthouse.seo
                        ],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Security Chart
            if (charts.security) charts.security.destroy();
            charts.security = new Chart(document.getElementById('securityChart'), {
                type: 'bar',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        label: 'Vulnerabilities',
                        data: [
                            metricsData.security.vulnerabilities.critical,
                            metricsData.security.vulnerabilities.high,
                            metricsData.security.vulnerabilities.medium,
                            metricsData.security.vulnerabilities.low
                        ],
                        backgroundColor: ['#dc2626', '#ea580c', '#d97706', '#ca8a04']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateTestSuites() {
            const testSuites = document.getElementById('testSuites');
            
            const suites = Object.entries(metricsData.tests.suites).map(([name, data]) => {
                const successRate = (data.passed / data.total * 100).toFixed(1);
                const status = data.failed === 0 ? 'passed' : data.failed > data.passed ? 'failed' : 'partial';
                
                return `
                    <div class="suite-card">
                        <div class="suite-header">
                            <div class="suite-title">${name.charAt(0).toUpperCase() + name.slice(1)} Tests</div>
                            <div class="suite-status ${status}">${status}</div>
                        </div>
                        <div class="suite-body">
                            <div class="metrics-row">
                                <span class="metric-label">Total Tests</span>
                                <span class="metric-value">${data.total}</span>
                            </div>
                            <div class="metrics-row">
                                <span class="metric-label">Success Rate</span>
                                <span class="metric-value">${successRate}%</span>
                            </div>
                            <div class="metrics-row">
                                <span class="metric-label">Duration</span>
                                <span class="metric-value">${Math.round(data.duration / 1000)}s</span>
                            </div>
                            <div class="metrics-row">
                                <span class="metric-label">Flaky Tests</span>
                                <span class="metric-value">${data.flaky || 0}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${successRate}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            testSuites.innerHTML = suites.join('');
        }

        function updateAlerts() {
            const alertsList = document.getElementById('alertsList');
            const alerts = [];

            // Coverage alerts
            if (metricsData.coverage.overall.lines < 90) {
                alerts.push({
                    type: 'warning',
                    title: 'Low Code Coverage',
                    description: `Overall coverage is ${metricsData.coverage.overall.lines.toFixed(1)}% (target: 90%)`
                });
            }

            // Test failures
            if (metricsData.tests.failed > 0) {
                alerts.push({
                    type: 'critical',
                    title: 'Test Failures',
                    description: `${metricsData.tests.failed} tests are failing and need immediate attention`
                });
            }

            // Security vulnerabilities
            if (metricsData.security.vulnerabilities.critical > 0) {
                alerts.push({
                    type: 'critical',
                    title: 'Critical Security Vulnerabilities',
                    description: `${metricsData.security.vulnerabilities.critical} critical vulnerabilities found`
                });
            }

            // Performance issues
            if (metricsData.performance.lighthouse.performance < 80) {
                alerts.push({
                    type: 'warning',
                    title: 'Performance Issues',
                    description: `Lighthouse performance score is ${metricsData.performance.lighthouse.performance} (target: 90+)`
                });
            }

            // Accessibility issues
            if (metricsData.accessibility.violations.critical > 0) {
                alerts.push({
                    type: 'critical',
                    title: 'Critical Accessibility Violations',
                    description: `${metricsData.accessibility.violations.critical} critical accessibility issues found`
                });
            }

            if (alerts.length === 0) {
                alerts.push({
                    type: 'info',
                    title: 'All Systems Operational',
                    description: 'No critical issues detected. Great job maintaining quality!'
                });
            }

            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <div class="alert-icon ${alert.type}">
                        ${alert.type === 'critical' ? 'üö®' : alert.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-description">${alert.description}</div>
                    </div>
                </div>
            `).join('');
        }

        // Auto-refresh every 5 minutes
        setInterval(loadData, 5 * 60 * 1000);

        // Initial load
        loadData();
    </script>
</body>
</html>